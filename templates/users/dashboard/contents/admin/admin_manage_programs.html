{% extends "users/dashboard/admin_dashboard_layout.html" %}
<!-- =============================== -->
{% block title %} Manage Programs {% endblock %}
<!-- =============================== -->
{% block content %}

<div class="max-w-6xl mx-auto px-4">
  <!-- =============================== -->
  <!--  SECTION: MANAGE DEPARTMENTS   -->
  <!-- =============================== -->

  <h2 class="text-2xl font-semibold mb-6 text-gray-800">Manage Departments</h2>

  <!-- Add Department -->
  <div class="bg-white border border-gray-200 rounded-lg mb-10">
    <div
      class="border-b border-gray-300 px-4 py-3 bg-gray-100 font-medium text-gray-700"
    >
      Add New Department
    </div>
    <form method="POST" class="space-y-4 p-6">
      {% csrf_token %}
      <input type="hidden" name="create_department" value="1" />

      <div>
        <label class="block text-gray-600 mb-1">Department Name</label>
        <input
          type="text"
          name="dept_name"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500"
          placeholder="Enter department name"
          required
        />
      </div>
      <div>
        <label class="block text-gray-600 mb-1">Assign Dean (optional)</label>
        <select
          name="dean_id"
          class="w-full border border-gray-300 rounded-md px-3 py-2"
        >
          <option value="">-- Select Dean --</option>
          {% for dean in deans %}
          <option value="{{ dean.id }}">
            {{ dean.get_full_name }} ({{ dean.username }})
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="flex">
        <button
          type="submit"
          class="ml-auto bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
        >
          Add Department
        </button>
      </div>
    </form>
  </div>

  <!-- Existing Departments -->
  <div class="bg-white border border-gray-200 rounded-lg mb-16">
    <div
      class="border-b border-gray-300 px-4 py-3 bg-gray-100 font-medium text-gray-700"
    >
      Existing Departments
    </div>
    <div class="p-6">
      {% if departments %}
      <table class="min-w-full text-sm divide-y divide-gray-200">
        <thead class="bg-gray-50 text-left">
          <tr>
            <th class="px-4 py-2 text-left text-gray-600">#</th>
            <th class="px-4 py-2 text-left text-gray-600">Name</th>
            <th class="px-4 py-2 text-left text-gray-600">Code</th>
            <th class="px-4 py-2 text-left text-gray-600">Dean</th>
            <th class="px-4 py-2 text-left text-gray-600">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 text-left">
          {% for dept in departments %}
          <tr>
            <td class="px-4 py-2">{{ forloop.counter }}</td>
            <td class="px-4 py-2">{{ dept.name }}</td>
            <td class="px-4 py-2">{{ dept.code }}</td>
            <td class="px-4 py-2">
              {{ dept.dean.first_name }} {{ dept.dean.last_name }}
            </td>
            <td class="px-4 py-2 space-x-3">
              <button
                onclick="openDeptEdit('{{ dept.id|escapejs }}', '{{ dept.name|escapejs }}', '{{ dept.dean.id|escapejs }}')"
                class="text-blue-600 hover:underline cursor-pointer"
              >
                Edit
              </button>

              <button
                onclick="openDeleteDeptModal('{{ dept.id }}')"
                class="text-red-600 hover:underline cursor-pointer"
              >
                Delete
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-gray-500">No departments created yet.</p>
      {% endif %}
    </div>
  </div>

  <!-- =============================== -->
  <!--  SECTION: MANAGE PROGRAMS      -->
  <!-- =============================== -->

  <h2 class="text-2xl font-semibold mb-6 text-gray-800">Manage Programs</h2>

  <!-- Add Program -->
  <div class="bg-white border border-gray-200 rounded-lg">
    <div
      class="border-b border-gray-300 px-4 py-3 bg-gray-100 font-medium text-gray-700"
    >
      Add New Program
    </div>

    <form method="POST" class="space-y-4 p-6">
      {% csrf_token %}
      <input type="hidden" name="create_program" value="1" />

      <div>
        <label class="block text-gray-600 mb-1">Program Name</label>
        <input
          type="text"
          name="name"
          class="w-full border border-gray-300 rounded-md px-3 py-2"
          required
        />
      </div>

      <div>
        <label class="block text-gray-600 mb-1">Description</label>
        <textarea
          name="description"
          class="w-full border border-gray-300 rounded-md px-3 py-2"
          rows="3"
        ></textarea>
      </div>

      <div>
        <label class="block text-gray-600 mb-1">Select Department</label>
        <select
          name="department_id"
          class="w-full border border-gray-300 rounded-md px-3 py-2"
          required
        >
          <option value="">-- Select Department --</option>
          {% for dept in departments %}
          <option value="{{ dept.id }}">{{ dept.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="flex">
        <button
          type="submit"
          class="ml-auto bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
        >
          Add Program
        </button>
      </div>
    </form>
  </div>

  <!-- Existing Programs -->
  <div class="bg-white border border-gray-200 rounded-lg mt-10">
    <div
      class="border-b border-gray-300 px-4 py-3 bg-gray-100 font-medium text-gray-700"
    >
      Existing Programs
    </div>

    <div class="p-6">
      {% if programs %}
      <table class="min-w-full text-sm divide-y divide-gray-200">
        <thead class="bg-gray-50 text-left">
          <tr>
            <th class="px-4 py-2">#</th>
            <th class="px-4 py-2">Program</th>
            <th class="px-4 py-2">Dept</th>
            <th class="px-4 py-2">Code</th>
            <th class="px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 text-left">
          {% for p in programs %}
          <tr>
            <td class="px-4 py-2">{{ forloop.counter }}</td>
            <td class="px-4 py-2">{{ p.name }}</td>
            <td class="px-4 py-2">{{ p.department.name }}</td>
            <td class="px-4 py-2">{{ p.code }}</td>
            <td class="px-4 py-2">
              <button
                onclick="openProgEdit('{{ p.id }}', '{{ p.name }}', '{{ p.description }}')"
                class="text-blue-600 hover:underline mr-2 cursor-pointer"
              >
                Edit
              </button>
              <button
                onclick="openDeleteProgramModal('{{ p.id }}')"
                class="text-red-600 hover:underline cursor-pointer"
              >
                Delete
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>No programs added yet.</p>
      {% endif %}
    </div>
  </div>
</div>

<!-- =============================== -->
<!--      MODALS FOR EDITING        -->
<!-- =============================== -->

<!-- Program Modal -->
<div
  id="editModal"
  class="hidden fixed inset-0 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background-color: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white rounded-lg p-6 w-96 shadow-black/50 shadow-2xl">
    <h3 class="text-lg font-medium text-gray-700 mb-4">Edit Program</h3>

    <form method="POST" class="space-y-4">
      {% csrf_token %}
      <input type="hidden" name="update_program" value="1" />
      <input type="hidden" name="program_id" id="editProgramId" />

      <div>
        <label class="block text-gray-600 mb-1">Program Name</label>
        <input
          class="w-full border border-gray-300 rounded-md px-3 py-2"
          name="name"
          id="editProgramName"
          required
        />
      </div>

      <div>
        <label class="block text-gray-600 mb-1">Description</label>
        <textarea
          class="w-full border border-gray-300 rounded-md px-3 py-2"
          name="description"
          id="editProgramDescription"
        ></textarea>
      </div>

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeEditModal()"
          class="border px-4 py-2 rounded"
        >
          Cancel
        </button>
        <button class="bg-blue-600 text-white px-4 py-2 rounded">Update</button>
      </div>
    </form>
  </div>
</div>

<!-- Program Delete Modal -->
<div
  id="deleteProgramModal"
  class="hidden fixed inset-0 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background-color: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white rounded-lg p-6 w-96 shadow-black/50 shadow-2xl">
    <h3 class="text-lg font-medium text-gray-700 mb-4">Delete Program</h3>
    <p class="mb-4">Are you sure you want to delete this program?</p>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="delete_program" value="1" />
      <input type="hidden" name="program_id" id="deleteProgramId" />

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeDeleteProgramModal()"
          class="border px-4 py-2 rounded"
        >
          Cancel
        </button>
        <button class="bg-red-600 text-white px-4 py-2 rounded">Delete</button>
      </div>
    </form>
  </div>
</div>

<!-- Department Modal -->
<div
  id="editDeptModal"
  class="hidden fixed inset-0 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background-color: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white rounded-lg p-6 w-96 shadow-black/50 shadow-2xl">
    <h3 class="text-lg font-medium text-gray-700 mb-4">Edit Department</h3>

    <form method="POST" class="space-y-4">
      {% csrf_token %}
      <input type="hidden" name="update_department" value="1" />
      <input type="hidden" name="dept_id" id="editDeptId" />

      <div>
        <label class="block text-gray-600 mb-1">Department Name</label>
        <input
          class="w-full border border-gray-300 rounded-md px-3 py-2"
          name="dept_name"
          id="editDeptName"
          required
        />
      </div>

      <div>
        <label class="block text-gray-600 mb-1">Assign Dean (optional)</label>
        <select
          name="dean_id"
          id="editDeptDean"
          class="w-full border border-gray-300 rounded-md px-3 py-2"
        >
          <option value="">-- Select Dean --</option>
          {% for dean in deans %}
          <option value="{{ dean.id }}">
            {{ dean.get_full_name }} ({{ dean.username }})
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeDeptModal()"
          class="border px-4 py-2 rounded"
        >
          Cancel
        </button>
        <button class="bg-blue-600 text-white px-4 py-2 rounded">Update</button>
      </div>
    </form>
  </div>
</div>

<!-- Department Delete Modal -->
<div
  id="deleteDeptModal"
  class="hidden fixed inset-0 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background-color: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white rounded-lg p-6 w-96 shadow-2xl shadow-black/50">
    <h3 class="text-lg font-medium text-gray-700 mb-4">Delete Department</h3>
    <p class="mb-4">Are you sure you want to delete this department?</p>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="delete_department" value="1" />
      <input type="hidden" name="dept_id" id="deleteDeptId" />

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeDeleteDeptModal()"
          class="border px-4 py-2 rounded"
        >
          Cancel
        </button>
        <button class="bg-red-600 text-white px-4 py-2 rounded">Delete</button>
      </div>
    </form>
  </div>
</div>

<script>
  function openProgEdit(id, name, description) {
    document.getElementById("editProgramId").value = id;
    document.getElementById("editProgramName").value = name;
    document.getElementById("editProgramDescription").value = description;
    document.getElementById("editModal").classList.remove("hidden");
  }

  function closeEditModal() {
    document.getElementById("editModal").classList.add("hidden");
  }

  function openDeptEdit(id, name, deanId) {
    document.getElementById("editDeptId").value = id;
    document.getElementById("editDeptName").value = name;
    document.getElementById("editDeptDean").value = deanId || "";
    document.getElementById("editDeptModal").classList.remove("hidden");
  }

  function closeDeptModal() {
    document.getElementById("editDeptModal").classList.add("hidden");
  }

  // Departments
  function openDeleteDeptModal(id) {
    document.getElementById("deleteDeptId").value = id;
    document.getElementById("deleteDeptModal").classList.remove("hidden");
  }

  function closeDeleteDeptModal() {
    document.getElementById("deleteDeptModal").classList.add("hidden");
  }

  // Programs
  function openDeleteProgramModal(id) {
    document.getElementById("deleteProgramId").value = id;
    document.getElementById("deleteProgramModal").classList.remove("hidden");
  }

  function closeDeleteProgramModal() {
    document.getElementById("deleteProgramModal").classList.add("hidden");
  }
</script>

{% endblock %}
