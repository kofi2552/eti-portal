{% extends "users/dashboard/admin_dashboard_layout.html" %} {% block title %}
Academic Years & Semesters {% endblock %} {% block content %}

<div class="max-w-5xl mx-auto px-4 py-6 space-y-10">
  <!-- ===================== -->
  <!--   ACADEMIC YEARS      -->
  <!-- ===================== -->
  <div>
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-2xl font-semibold text-gray-800">Academic Years</h2>
      <button
        onclick="openYearCreate()"
        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 cursor-pointer"
      >
        Add Academic Year
      </button>
    </div>

    <div class="bg-white border border-gray-200 rounded-lg">
      <table class="min-w-full text-sm divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-2 text-left text-gray-600">Name</th>
            <th class="px-4 py-2 text-left text-gray-600">Start</th>
            <th class="px-4 py-2 text-left text-gray-600">End</th>
            <th class="px-4 py-2 text-left text-gray-600">Active</th>
            <th class="px-4 py-2 text-left text-gray-600">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          {% for y in academic_years %}
          <tr>
            <td class="px-4 py-2">{{ y.name }}</td>
            <td class="px-4 py-2">
              {{ y.start_date|date:"Y-m-d"|default:"-" }}
            </td>
            <td class="px-4 py-2">{{ y.end_date|date:"Y-m-d"|default:"-" }}</td>
            <td class="px-4 py-2">
              {% if y.is_active %}
              <span class="text-green-600 font-medium">Active</span>
              {% else %}
              <span class="text-gray-500">Inactive</span>
              {% endif %}
            </td>

            <td class="px-4 py-2 space-x-3">
              <button
                class="text-blue-600 hover:underline cursor-pointer year-edit-btn"
                data-id="{{ y.id }}"
                data-name="{{ y.name|escapejs }}"
                data-start="{{ y.start_date|date:'Y-m-d' }}"
                data-end="{{ y.end_date|date:'Y-m-d' }}"
                data-active="{{ y.is_active }}"
              >
                Edit
              </button>

              <button
                onclick="openYearDelete('{{ y.id }}')"
                class="text-red-600 hover:underline"
              >
                Delete
              </button>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="px-4 py-4 text-gray-500 text-center">
              No academic years found.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===================== -->
  <!--      SEMESTERS        -->
  <!-- ===================== -->
  <div>
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-2xl font-semibold text-gray-800">Semesters</h2>
      <button
        onclick="openSemCreate()"
        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 cursor-pointer"
      >
        Add Semester
      </button>
    </div>

    <div class="bg-white border border-gray-200 rounded-lg">
      <table class="min-w-full text-sm divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-2 text-left text-gray-600">Semester</th>
            <th class="px-4 py-2 text-left text-gray-600">Academic Year</th>
            <th class="px-4 py-2 text-left text-gray-600">Start</th>
            <th class="px-4 py-2 text-left text-gray-600">End</th>
            <th class="px-4 py-2 text-left text-gray-600">Active</th>
            <th class="px-4 py-2 text-left text-gray-600">Actions</th>
          </tr>
        </thead>

        <tbody class="divide-y divide-gray-100">
          {% for s in semesters %}
          <tr>
            <td class="px-4 py-2">{{ s.name }}</td>
            <td class="px-4 py-2">{{ s.academic_year.name }}</td>
            <td class="px-4 py-2">
              {{ s.start_date|date:"Y-m-d"|default:"-" }}
            </td>
            <td class="px-4 py-2">{{ s.end_date|date:"Y-m-d"|default:"-" }}</td>

            <td class="px-4 py-2">
              {% if s.is_active %}
              <span class="text-green-600 font-medium">Active</span>
              {% else %}
              <span class="text-gray-500">Inactive</span>
              {% endif %}
            </td>

            <td class="px-4 py-2 space-x-3">
              <button
                class="text-blue-600 hover:underline cursor-pointer sem-edit-btn"
                data-id="{{ s.id }}"
                data-name="{{ s.name|escapejs }}"
                data-year="{{ s.academic_year.id }}"
                data-start="{{ s.start_date|date:'Y-m-d' }}"
                data-end="{{ s.end_date|date:'Y-m-d' }}"
                data-active="{{ s.is_active }}"
              >
                Edit
              </button>

              <button
                onclick="openSemDelete('{{ s.id }}')"
                class="text-red-600 hover:underline"
              >
                Delete
              </button>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="px-4 py-4 text-gray-500 text-center">
              No semesters found.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="mt-10">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold">Grade Settings</h2>

      <button
        onclick="openCreateGrade()"
        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700"
      >
        Add Grade
      </button>
    </div>

    <div class="bg-white border-c rounded-lg">
      <table class="min-w-full text-sm divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr class="text-left">
            <th class="px-4 py-2">Letter</th>
            <th class="px-4 py-2">Min Score</th>
            <th class="px-4 py-2">Max Score</th>
            <th class="px-4 py-2">Actions</th>
          </tr>
        </thead>

        <tbody class="divide-y divide-gray-100">
          {% for g in grades %}
          <tr>
            <td class="px-4 py-2">{{ g.letter }}</td>
            <td class="px-4 py-2">{{ g.min_score }}</td>
            <td class="px-4 py-2">{{ g.max_score }}</td>

            <td class="px-4 py-2 space-x-3">
              <!-- EDIT -->
              <button
                onclick="openEditGrade('{{ g.id }}','{{ g.letter }}','{{ g.min_score }}','{{ g.max_score }}')"
                class="text-blue-600 hover:underline"
              >
                Edit
              </button>

              <!-- DELETE -->
              <button
                onclick="openDeleteGrade('{{ g.id }}')"
                class="text-red-600 hover:underline"
              >
                Delete
              </button>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4" class="px-4 py-4 text-center text-gray-500">
              No grade rules added.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ========================================================= -->
<!-- ======================== MODALS ========================== -->
<!-- ========================================================= -->

<div
  id="createGradeModal"
  class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white w-96 p-6 rounded shadow">
    <h3 class="text-lg font-semibold mb-4">Add Grade</h3>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="create_grade" value="1" />

      <label class="block mb-1">Letter</label>
      <input name="letter" class="w-full border rounded px-3 py-2 mb-3" />

      <label class="block mb-1">Min Score</label>
      <input
        name="min_score"
        type="number"
        step="0.01"
        class="w-full border rounded px-3 py-2 mb-3"
      />

      <label class="block mb-1">Max Score</label>
      <input
        name="max_score"
        type="number"
        step="0.01"
        class="w-full border rounded px-3 py-2 mb-3"
      />

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeCreateGrade()"
          class="px-4 py-2 border rounded"
        >
          Cancel
        </button>
        <button class="px-4 py-2 bg-blue-600 text-white rounded">Save</button>
      </div>
    </form>
  </div>
</div>

<div
  id="editGradeModal"
  class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white w-96 p-6 rounded shadow">
    <h3 class="text-lg font-semibold mb-4">Edit Grade</h3>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="update_grade" value="1" />
      <input type="hidden" name="grade_id" id="editGradeId" />

      <label class="block mb-1">Letter</label>
      <input
        name="letter"
        id="editGradeLetter"
        class="w-full border rounded px-3 py-2 mb-3"
      />

      <label class="block mb-1">Min Score</label>
      <input
        name="min_score"
        id="editGradeMin"
        type="number"
        step="0.01"
        class="w-full border rounded px-3 py-2 mb-3"
      />

      <label class="block mb-1">Max Score</label>
      <input
        name="max_score"
        id="editGradeMax"
        type="number"
        step="0.01"
        class="w-full border rounded px-3 py-2 mb-3"
      />

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeEditGrade()"
          class="px-4 py-2 border rounded"
        >
          Cancel
        </button>
        <button class="px-4 py-2 bg-blue-600 text-white rounded">Update</button>
      </div>
    </form>
  </div>
</div>

<div
  id="deleteGradeModal"
  class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white w-80 p-6 rounded shadow">
    <h3 class="text-lg font-semibold mb-4 text-red-600">Delete Grade</h3>

    <p class="mb-4">Are you sure you want to delete this grade?</p>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="delete_grade" value="1" />
      <input type="hidden" name="grade_id" id="deleteGradeId" />

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeDeleteGrade()"
          class="px-4 py-2 border rounded"
        >
          Cancel
        </button>
        <button class="px-4 py-2 bg-red-600 text-white rounded">Delete</button>
      </div>
    </form>
  </div>
</div>

<!-- YEAR CREATE -->
<div
  id="yearCreateModal"
  class="hidden fixed inset-0 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white border rounded-lg p-6 w-96">
    <h3 class="text-lg font-medium mb-4">Create Academic Year</h3>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="create_academic_year" value="1" />

      <label class="block mb-1 text-gray-700">Name</label>
      <input
        name="name"
        required
        class="w-full border rounded-md px-3 py-2 mb-3"
      />

      <label class="block mb-1 text-gray-700">Start Date</label>
      <input
        type="date"
        name="start_date"
        class="w-full border rounded-md px-3 py-2 mb-3"
      />

      <label class="block mb-1 text-gray-700">End Date</label>
      <input
        type="date"
        name="end_date"
        class="w-full border rounded-md px-3 py-2 mb-3"
      />

      <label class="flex items-center space-x-2 mb-4">
        <input type="checkbox" name="is_active" />
        <span>Active</span>
      </label>

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeYearCreate()"
          class="px-4 py-2 border rounded-md"
        >
          Cancel
        </button>
        <button class="bg-blue-600 text-white px-4 py-2 rounded-md">
          Create
        </button>
      </div>
    </form>
  </div>
</div>

<!-- YEAR EDIT -->
<div
  id="yearEditModal"
  class="hidden fixed inset-0 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white border rounded-lg p-6 w-96">
    <h3 class="text-lg font-medium mb-4">Edit Academic Year</h3>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="update_academic_year" value="1" />
      <input type="hidden" name="academic_year_id" id="yearEditId" />

      <label>Name</label>
      <input
        name="name"
        id="yearEditName"
        class="w-full border rounded-md px-3 py-2 mb-3"
      />

      <label>Start Date</label>
      <input
        type="date"
        name="start_date"
        id="yearEditStart"
        class="w-full border rounded-md px-3 py-2 mb-3"
      />

      <label>End Date</label>
      <input
        type="date"
        name="end_date"
        id="yearEditEnd"
        class="w-full border rounded-md px-3 py-2 mb-3"
      />

      <label class="flex items-center space-x-2 mb-4">
        <input type="checkbox" name="is_active" id="yearEditActive" />
        <span>Active</span>
      </label>

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeYearEdit()"
          class="px-4 py-2 border rounded-md"
        >
          Cancel
        </button>
        <button class="bg-blue-600 text-white px-4 py-2 rounded-md">
          Update
        </button>
      </div>
    </form>
  </div>
</div>

<!-- YEAR DELETE -->
<div
  id="yearDeleteModal"
  class="hidden fixed inset-0 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white border rounded-lg p-6 w-96">
    <h3 class="text-lg font-medium mb-4 text-red-600">Delete Academic Year</h3>
    <p>Are you sure?</p>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="delete_academic_year" value="1" />
      <input type="hidden" name="academic_year_id" id="yearDeleteId" />

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeYearDelete()"
          class="px-4 py-2 border rounded-md"
        >
          Cancel
        </button>
        <button class="bg-red-600 text-white px-4 py-2 rounded-md">
          Delete
        </button>
      </div>
    </form>
  </div>
</div>

<!-- SEM CREATE -->
<div
  id="semCreateModal"
  class="hidden fixed inset-0 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white border rounded-lg p-6 w-96">
    <h3 class="text-lg font-medium mb-4">Create Semester</h3>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="create_semester" value="1" />

      <label>Name</label>
      <input
        name="name"
        required
        class="w-full border rounded-md px-3 py-2 mb-3"
      />

      <label>Academic Year</label>
      <select
        name="academic_year_id"
        required
        class="w-full border rounded-md px-3 py-2 mb-3"
      >
        <option value="">-- Select --</option>
        {% for y in academic_years %}
        <option value="{{ y.id }}">{{ y.name }}</option>
        {% endfor %}
      </select>

      <label>Start Date</label>
      <input
        type="date"
        name="start_date"
        class="w-full border rounded-md px-3 py-2 mb-3"
      />

      <label>End Date</label>
      <input
        type="date"
        name="end_date"
        class="w-full border rounded-md px-3 py-2 mb-3"
      />

      <label class="flex items-center space-x-2 mb-4">
        <input type="checkbox" name="is_active" />
        <span>Active</span>
      </label>

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeSemCreate()"
          class="px-4 py-2 border rounded-md"
        >
          Cancel
        </button>
        <button class="bg-blue-600 text-white px-4 py-2 rounded-md">
          Create
        </button>
      </div>
    </form>
  </div>
</div>

<!-- SEM EDIT -->
<div
  id="semEditModal"
  class="hidden fixed inset-0 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white border rounded-lg p-6 w-96">
    <h3 class="text-lg font-medium mb-4">Edit Semester</h3>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="update_semester" value="1" />
      <input type="hidden" name="semester_id" id="semEditId" />

      <label>Name</label>
      <input
        name="name"
        id="semEditName"
        class="w-full border rounded-md px-3 py-2 mb-3"
      />

      <label>Academic Year</label>
      <select
        name="academic_year_id"
        id="semEditYear"
        class="w-full border rounded-md px-3 py-2 mb-3"
      >
        {% for y in academic_years %}
        <option value="{{ y.id }}">{{ y.name }}</option>
        {% endfor %}
      </select>

      <label>Start Date</label>
      <input
        type="date"
        name="start_date"
        id="semEditStart"
        class="w-full border rounded-md px-3 py-2 mb-3"
      />

      <label>End Date</label>
      <input
        type="date"
        name="end_date"
        id="semEditEnd"
        class="w-full border rounded-md px-3 py-2 mb-3"
      />

      <label class="flex items-center space-x-2 mb-4">
        <input type="checkbox" name="is_active" id="semEditActive" />
        <span>Active</span>
      </label>

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeSemEdit()"
          class="px-4 py-2 border rounded-md"
        >
          Cancel
        </button>
        <button class="bg-blue-600 text-white px-4 py-2 rounded-md">
          Update
        </button>
      </div>
    </form>
  </div>
</div>

<!-- SEM DELETE -->
<div
  id="semDeleteModal"
  class="hidden fixed inset-0 flex items-center justify-center"
  style="backdrop-filter: blur(6px); background: rgba(255, 255, 255, 0.3)"
>
  <div class="bg-white border rounded-lg p-6 w-96">
    <h3 class="text-lg font-medium text-red-600 mb-4">Delete Semester</h3>
    <p>Are you sure?</p>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="delete_semester" value="1" />
      <input type="hidden" name="semester_id" id="semDeleteId" />

      <div class="flex justify-end space-x-2">
        <button
          type="button"
          onclick="closeSemDelete()"
          class="px-4 py-2 border rounded-md"
        >
          Cancel
        </button>
        <button class="bg-red-600 text-white px-4 py-2 rounded-md">
          Delete
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ================================ -->
<!--         JAVASCRIPT HANDLERS     -->
<!-- ================================ -->
<script>
  // ==========================
  // GRADE SECTION
  // ==========================

  function openCreateGrade() {
    document.getElementById("createGradeModal").classList.remove("hidden");
  }
  function closeCreateGrade() {
    document.getElementById("createGradeModal").classList.add("hidden");
  }

  function openEditGrade(id, letter, min, max) {
    document.getElementById("editGradeId").value = id;
    document.getElementById("editGradeLetter").value = letter;
    document.getElementById("editGradeMin").value = min;
    document.getElementById("editGradeMax").value = max;
    document.getElementById("editGradeModal").classList.remove("hidden");
  }
  function closeEditGrade() {
    document.getElementById("editGradeModal").classList.add("hidden");
  }

  function openDeleteGrade(id) {
    document.getElementById("deleteGradeId").value = id;
    document.getElementById("deleteGradeModal").classList.remove("hidden");
  }
  function closeDeleteGrade() {
    document.getElementById("deleteGradeModal").classList.add("hidden");
  }

  // ==========================
  // ACADEMIC YEAR CREATE
  // ==========================
  function openYearCreate() {
    document.getElementById("yearCreateModal").classList.remove("hidden");
  }
  function closeYearCreate() {
    document.getElementById("yearCreateModal").classList.add("hidden");
  }

  // ==========================
  // ACADEMIC YEAR EDIT
  // ==========================
  document.querySelectorAll(".year-edit-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      document.getElementById("yearEditId").value = btn.dataset.id;
      document.getElementById("yearEditName").value = btn.dataset.name;
      document.getElementById("yearEditStart").value = btn.dataset.start || "";
      document.getElementById("yearEditEnd").value = btn.dataset.end || "";
      document.getElementById("yearEditActive").checked =
        btn.dataset.active === "True";

      document.getElementById("yearEditModal").classList.remove("hidden");
    });
  });

  function closeYearEdit() {
    document.getElementById("yearEditModal").classList.add("hidden");
  }

  // ==========================
  // ACADEMIC YEAR DELETE
  // ==========================
  function openYearDelete(id) {
    document.getElementById("yearDeleteId").value = id;
    document.getElementById("yearDeleteModal").classList.remove("hidden");
  }
  function closeYearDelete() {
    document.getElementById("yearDeleteModal").classList.add("hidden");
  }

  // ==========================
  // SEMESTER CREATE
  // ==========================
  function openSemCreate() {
    document.getElementById("semCreateModal").classList.remove("hidden");
  }
  function closeSemCreate() {
    document.getElementById("semCreateModal").classList.add("hidden");
  }

  // ==========================
  // SEMESTER EDIT
  // ==========================
  document.querySelectorAll(".sem-edit-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      document.getElementById("semEditId").value = btn.dataset.id;
      document.getElementById("semEditName").value = btn.dataset.name;
      document.getElementById("semEditYear").value = btn.dataset.year;
      document.getElementById("semEditStart").value = btn.dataset.start || "";
      document.getElementById("semEditEnd").value = btn.dataset.end || "";
      document.getElementById("semEditActive").checked =
        btn.dataset.active === "True";

      document.getElementById("semEditModal").classList.remove("hidden");
    });
  });

  function closeSemEdit() {
    document.getElementById("semEditModal").classList.add("hidden");
  }

  // ==========================
  // SEMESTER DELETE
  // ==========================
  function openSemDelete(id) {
    document.getElementById("semDeleteId").value = id;
    document.getElementById("semDeleteModal").classList.remove("hidden");
  }
  function closeSemDelete() {
    document.getElementById("semDeleteModal").classList.add("hidden");
  }
</script>

{% endblock %}
